# 任务四：usb3.0 主机控制器的初始化

USB 3.0 主机控制器的初始化，使得主机控制器可以正常工作

* 设置主机控制器寄存器。
* 配置主机控制器操作模式：选择适当的主机控制器操作模式。包括设置传输速度（例如超速或高速）、电源管理模式、端点配置等。
* 初始化传输环路和命令队列：USB 3.0 主机控制器使用传输环路和命令队列来管理数据传输和控制请求。需要初始化这些数据结构，并根据需要配置它们的大小、数量和优先级。
* 配置中断处理：USB 3.0 主机控制器会产生各种类型的中断，例如传输完成、错误报告、连接状态变化等。
* 分配和初始化数据缓冲区：USB 3.0 主机控制器使用数据缓冲区来存储传输的数据。需要分配适当大小的数据缓冲区，并进行初始化以确保正确的数据传输和接收。
* 配置端点参数：USB 3.0 主机控制器使用端点来管理数据传输的方向、类型和属性。需要配置每个端点的传输参数，例如最大包大小、传输方向、间隔等。
* 启用主机控制器功能：在完成上述配置后，设置相应的寄存器位或调用特定的函数来启用主机控制器。


## 相关寄存器介绍

### Host Controller Capability Registers（主机控制器能力寄存器）

* Offset Address : 00h

  Capability Registers Length (CAPLENGTH)（默认20h）

  | Bit（位） | 状态 |  值  |                             介绍                             |
  | :-------: | :--: | :--: | :----------------------------------------------------------: |
  |   7：0    | 只读 | 20h  | 能力寄存器长度<br/>该寄存器用作添加到寄存器基址的偏移量找到操作寄存器的开头空间。 |

* Offset Address : 01h（保留）

* Offset Address : 03-02h

  Host Controller Interface Version Number (HCIVERSION) （默认0100h）

  | Bit（位） | 状态 |  值   |         介绍         |
  | :-------: | :--: | :---: | :------------------: |
  |   15：0   | 只读 | 0100h | 主机控制器接口版本号 |

* Offset Address : 07-04h

  Structural Parameters 1 (HCSPARAMS1)（默认0500_0420h）

  | Bit（位） | 状态 |  值  |         介绍          |
  | :-------: | :--: | :--: | :-------------------: |
  |  31：24   | 只读 | 05h  |   端口数 (MaxPorts)   |
  |  23：19   | 只读 |  0   |         保留          |
  |   18：8   | 只读 | 04h  | 中断器数量 (MaxIntrs) |
  |   7：0    | 只读 | 20h  | 设备插槽数 (MaxSlots) |

* Offset Address : 0B-08h

  Structural Parameters 2 (HCSPARAMS2) （默认FC00_0031h）

  | Bit（位） | 状态 |  值  |       介绍       |
  | :-------: | :--: | :--: | :--------------: |
  |  31：27   | 只读 | 1Fh  | 最大暂存器缓冲区 |
  |    26     | 只读 |  1b  |                  |
  |  25：21   | 只读 |  0   |                  |
  |   20：8   | 只读 |  0   |       保留       |
  |   7：4    | 只读 |  3h  |                  |
  |   3：0    | 只读 |  1h  |                  |

* Offset Address : 0F-0Ch

  Structural Parameters 3 (HCSPARAMS3)（默认00E7_0004h）

  | Bit（位） | 状态 |  值   | 介绍 |
  | :-------: | :--: | :---: | :--: |
  |  31：16   | 只读 | 00E7h |      |
  |   15：8   | 只读 |   0   | 保留 |
  |   7：0    | 只读 |  04h  |      |

* Offset Address : 13-10h

  Capability Parameters (HCCPARAMS) （默认0028_41EBh）

  | Bit（位） | 状态 |  值   | 介绍 |
  | :-------: | :--: | :---: | :--: |
  |  31：16   | 只读 | 0028h |      |
  |  15：12   | 只读 |  4h   |      |
  |   11：9   | 只读 |   0   | 保留 |
  |     8     | 只读 |  1b   |      |
  |     7     | 只读 |  1b   |      |
  |     6     | 只读 |  1b   |      |
  |     5     | 只读 |  1b   |      |
  |     4     | 只读 |   0   |      |
  |     3     | 只读 |  1b   |      |
  |     2     | 只读 |   0   |      |
  |     1     | 只读 |  1b   |      |
  |     0     | 只读 |  1b   |      |

* Offset Address : 17-14h

  Doorbell Offset (DBOFF)（默认0000_0100h）

  | Bit（位） | 状态 |  值  | 介绍 |
  | :-------: | :--: | :--: | :--: |
  |   31：2   | 只读 | 40h  |      |
  |    1:0    | 只读 |  0   | 保留 |
  
* Offset Address : 1B-18h

  Runtime Register Space Offset (RTSOFF) （默认 0000_0200h）

  | Bit（位） | 状态 |  值  | 介绍 |
  | :-------: | :--: | :--: | :--: |
  |   31：5   | 只读 | 10h  |      |
  |   4：0    | 只读 |  0   | 保留 |

### Operational Registers（操作寄存器）


### Port Register（端口寄存器）


### Host Controller Runtime Register（）


### Interrupter Registers（中断寄存器）


## 代码实现
